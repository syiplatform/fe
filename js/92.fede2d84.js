(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[92],{"0da5":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"row items-stretch",attrs:{padding:""}},[n("q-card",{staticClass:"row col-xs-12 border-radius bg-white q-my-xs items-start",class:e.$q.screen.lt.sm?"q-py-md":"q-py-lg"},[n("q-card-section",{staticClass:"col-xs-12 col-sm-4"},[n("div",{staticClass:"q-mb-sm"},[e._v("\n      "+e._s(e.$t("company_external_notifications_viber_title"))+"\n      ")]),n("div",{staticClass:"row col-xs-12"},[n("q-btn",{staticClass:"col-xs-12",class:e.$q.screen.lt.sm?"":"q-mt-md",attrs:{rounded:"",label:e.$t("company_external_notifications_open_viber_bot"),color:"secondary","icon-right":"open_in_new"},on:{click:e.openViberBot}})],1),n("div",{staticClass:"row col-xs-12"},[n("q-btn",{staticClass:"col-xs-12",class:e.$q.screen.lt.sm?"q-mt-sm":"q-mt-md",attrs:{rounded:"",label:e.$t("open_instruction"),color:"info","icon-right":"open_in_new"},on:{click:function(t){return e.openInstruction("viber-instruction-btn")}}})],1)]),n("q-card-section",{staticClass:"row col-xs-12 col-sm items-center"},[e.isMessengerNotificationsDisabled?n("div",{staticClass:"col-xs-12"},[n("q-banner",{staticClass:"col-xs-12 q-my-md bg-warning cursor-pointer text-white border-radius",nativeOn:{click:function(t){return e.openTariffs(t)}},scopedSlots:e._u([{key:"avatar",fn:function(){return[n("q-icon",{attrs:{name:"warning",color:"white"}})]},proxy:!0}],null,!1,894313219)},[e._v("\n          "+e._s(e.$t("landing_tariff_large_1"))+"\n        ")])],1):n("div",{staticClass:"col-xs-12"},[e.isViberConnected?n("div",{staticClass:"q-mb-lg"},[n("p",[e._v("\n          "+e._s(e.$t("company_external_notifications_subscribed_title"))+":\n          ")]),e._l(e.viberClients,(function(t){return n("div",{key:t.id},[n("q-icon",{attrs:{color:"green",size:"26px",name:"done"}}),e._v("\n            "+e._s(t.messengerUserName||e.$t("company_external_notification_client_no_name"))+"\n            "),n("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",size:"sm",icon:"clear",color:"negative"},on:{click:function(n){return e.deleteSelectedBotClient(t.id,t.messengerType)}}})],1)}))],2):e._e(),n("div",[e._v("\n          "+e._s(e.$t(e.isViberConnected?"company_external_notifications_subscribe_more":"company_external_notifications_subscribe"))+":\n        ")]),n("div",{staticClass:"q-px-xs",class:e.$q.screen.lt.sm?"":"q-pr-lg"},[n("q-input",{attrs:{label:e.$t("company_external_notifications_enter_code"),hint:e.$t("company_external_notifications_viber_helper"),"bottom-slots":"",readonly:e.isMessengerNotificationsDisabled,"error-message":e.getErrorMessage(e.$v.verificationCode,e.t),type:"number",maxlength:"6"},scopedSlots:e._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:"help"},on:{click:function(t){return e.openInstruction("viber-help-icon")}}})]},proxy:!0}]),model:{value:e.verificationCodeViber,callback:function(t){e.verificationCodeViber="string"===typeof t?t.trim():t},expression:"verificationCodeViber"}}),n("q-btn",{attrs:{rounded:"",label:e.$t("company_external_notifications_send_code"),color:"primary"},on:{click:function(t){return e.sendVerificationCode(e.verificationCodeViber,e.messengerTypes.viber)}}})],1)])])],1),n("q-card",{staticClass:"row col-xs-12 border-radius bg-white q-my-xs items-start",class:e.$q.screen.lt.sm?"q-py-md":"q-py-lg"},[n("q-card-section",{staticClass:"row col-xs-12 col-sm-4"},[n("div",{staticClass:"q-mb-sm"},[e._v("\n        "+e._s(e.$t("company_external_notifications_telegram_title"))+"\n      ")]),n("div",{staticClass:"row col-xs-12"},[n("q-btn",{staticClass:"col-xs-12",class:e.$q.screen.lt.sm?"":"q-mt-md",attrs:{rounded:"",label:e.$t("company_external_notifications_open_telegram_bot"),color:"secondary","icon-right":"open_in_new"},on:{click:e.connectTelegram}})],1),n("div",{staticClass:"row col-xs-12"},[n("q-btn",{staticClass:"col-xs-12",class:e.$q.screen.lt.sm?"q-mt-sm":"q-mt-md",attrs:{rounded:"",label:e.$t("open_instruction"),color:"info","icon-right":"open_in_new"},on:{click:function(t){return e.openInstruction("telegram-instruction-btn")}}})],1)]),n("q-card-section",{staticClass:"row col-xs-12 col-sm items-center"},[e.isMessengerNotificationsDisabled?n("div",{staticClass:"col-xs-12"},[n("q-banner",{staticClass:"col-xs-12 q-my-md bg-warning cursor-pointer text-white border-radius",nativeOn:{click:function(t){return e.openTariffs(t)}},scopedSlots:e._u([{key:"avatar",fn:function(){return[n("q-icon",{attrs:{name:"warning",color:"white"}})]},proxy:!0}],null,!1,894313219)},[e._v("\n          "+e._s(e.$t("landing_tariff_large_1"))+"\n        ")])],1):n("div",{staticClass:"col-xs-12"},[e.isTelegramConnected?n("div",{staticClass:"q-mb-lg"},[n("p",[e._v("\n            "+e._s(e.$t("company_external_notifications_subscribed_title"))+":\n          ")]),e._l(e.telegramClients,(function(t){return n("div",{key:t.id},[n("q-icon",{attrs:{color:"green",size:"26px",name:"done"}}),e._v("\n            "+e._s(t.messengerUserName||e.$t("company_external_notification_client_no_name"))+"\n            "),n("q-btn",{staticClass:"q-ml-sm",attrs:{size:"sm",round:"",icon:"clear",color:"negative"},on:{click:function(n){return e.deleteSelectedBotClient(t.id,t.messengerType)}}})],1)}))],2):e._e(),n("div",[e._v("\n          "+e._s(e.$t(e.isTelegramConnected?"company_external_notifications_subscribe_more":"company_external_notifications_subscribe"))+":\n        ")]),n("div",{staticClass:"q-px-xs",class:e.$q.screen.lt.sm?"":"q-pr-lg"},[n("q-input",{attrs:{label:e.$t("company_external_notifications_enter_code"),hint:e.$t("company_external_notifications_telegram_helper"),"bottom-slots":"",readonly:e.isMessengerNotificationsDisabled,"error-message":e.getErrorMessage(e.$v.verificationCode,e.t),type:"number",maxlength:"6"},scopedSlots:e._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:"help"},on:{click:function(t){return e.openInstruction("telegram-help-icon")}}})]},proxy:!0}]),model:{value:e.verificationCodeTelegram,callback:function(t){e.verificationCodeTelegram="string"===typeof t?t.trim():t},expression:"verificationCodeTelegram"}}),n("q-btn",{attrs:{rounded:"",label:e.$t("company_external_notifications_send_code"),color:"primary"},on:{click:function(t){return e.sendVerificationCode(e.verificationCodeTelegram,e.messengerTypes.telegram)}}})],1)])])],1)],1)},r=[],o=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("96cf"),n("c973")),s=n.n(o),a=n("9523"),c=n.n(a),l=(n("c5f6"),n("2f62")),u=n("c98f"),m=n("b5ae"),d=n("d59f"),p=n("1cb6"),f=n("0cba"),_=n("382b"),b=n("ee47"),g={viber:1,telegram:2};function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h={name:"CompanyExternalNotifications",mixins:[b["a"]],data:function(){return{t:this.$t.bind(this),verificationCodeViber:"",verificationCodeTelegram:"",email:"",messengerTypes:g}},props:{companyId:{type:[Number,String]}},meta:function(){return{title:this.pageTitle}},computed:y({},Object(l["c"])("company",["companyDetails","companyTariff","botClients","externalNotificationValidateCodeData","botClientDeleteError","externalNotificationValidateCodeError"]),{isNotFetched:function(){return!0},pageTitle:function(){var e="";return this.companyDetails&&(e=this.companyDetails.urlPath),this.$t("company_notifications_page_title",{project:e})},isMessengerNotificationsDisabled:function(){return this.companyTariff!==u["h"].Large1},isViberPending:function(){return!0},isTelegramPending:function(){return!0},viberClients:function(){return this.botClients.filter((function(e){return"viber"===e.messengerType}))},telegramClients:function(){return this.botClients.filter((function(e){return"telegram"===e.messengerType}))},isViberConnected:function(){return null!=this.viberClients&&this.viberClients.length>0},isTelegramConnected:function(){return null!=this.telegramClients&&this.telegramClients.length>0}}),validations:function(){return{verificationCode:{required:m["required"],maxLength:Object(m["maxLength"])(6)},email:{required:m["required"],email:m["email"]}}},mounted:function(){this.trackUserAction({actionName:"openNotificationsPage"})},methods:y({},Object(l["b"])("auth",["trackUserAction"]),{},Object(l["b"])("company",["sendMessengerVerificationCode","fetchIndividualCompanyDetails","fetchBotClientList","deleteBotClient"]),{getErrorMessage:d["a"],openInstruction:function(e){window.open("https://seeyour.info/blog/ru/baza-znanij/uvedomleniya-cherez-messendzhery/","_blank"),p["a"].logEvent("external-notifications-page","open-instruction",e,0,this.$router.currentRoute)},fetch:function(){var e=s()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.fetchIndividualCompanyDetails({variables:{id:this.companyId}});case 2:return e.next=4,this.fetchBotClientList({variables:{companyId:this.companyId}});case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),sendVerificationCode:function(){var e=s()(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isMessengerNotificationsDisabled){e.next=2;break}return e.abrupt("return");case 2:return this.$v.$touch(),e.prev=3,e.next=6,this.sendMessengerVerificationCode({variables:{code:t,companyId:this.companyId,messengerType:n}});case 6:this.externalNotificationValidateCodeError?this.$q.notify({type:"negative",message:this.externalNotificationValidateCodeError}):(this.$q.notify({type:"positive",message:this.$t("company_external_notifications_code_success_updated")}),n===g.viber?(this.verificationCodeViber="",this.trackUserAction({actionName:"doneViberBot"})):n===g.telegram&&(this.verificationCodeTelegram="",this.trackUserAction({actionName:"doneTelegramBot"})),p["a"].logEvent("external-notifications-page","send-verification-code",n,0,this.$router.currentRoute)),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](3),this.$q.notify({type:"negative",message:this.$t("company_external_notifications_code_errors_can_not_save")});case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t,n){return e.apply(this,arguments)}return t}(),deleteSelectedBotClient:function(){var e=s()(regeneratorRuntime.mark((function e(t,n){var i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$q.dialog({title:this.$t("confirmation_dialog_title"),message:this.$t("company_external_notifications_confirm_dialog_confirmation"),ok:this.$t("Yes"),cancel:this.$t("No")}).onOk(s()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.deleteBotClient({variables:{id:t,companyId:i.companyId}});case 3:i.botClientDeleteError?i.$q.notify({type:"negative",message:i.botClientDeleteError}):(i.$q.notify({type:"positive",message:i.$t("company_external_notifications_open_bot_deleted")}),p["a"].logEvent("external-notifications-page","delete-client",n,0,i.$router.currentRoute)),e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),i.$q.notify({type:"negative",message:i.$t("company_external_notifications_cant_delete_bot")});case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),openViberBot:function(){var e=Object(_["k"])("viber://pa?chatURI=".concat({viber:"evgenybot",telegram:"evgenyinfobot"}.viber));e&&Object(f["a"])(e),p["a"].logEvent("external-notifications-page","open-bot","viber",0,this.$router.currentRoute),this.trackUserAction({actionName:"openViberBot"})},connectTelegram:function(){var e=Object(_["i"])("".concat({viber:"evgenybot",telegram:"evgenyinfobot"}.telegram));e&&Object(f["a"])(e),p["a"].logEvent("external-notifications-page","open-bot","telegram",0,this.$router.currentRoute),this.trackUserAction({actionName:"openTelegramBot"})},openTariffs:function(){p["a"].logEvent("company-tariffs-page","fromElement","external-notifications",0,this.$router.currentRoute),this.$router.push({name:"tariffs",params:{companyId:this.companyDetails.id}})}})},x=h,C=n("42e1"),q=Object(C["a"])(x,i,r,!1,null,null,null);t["default"]=q.exports}}]);